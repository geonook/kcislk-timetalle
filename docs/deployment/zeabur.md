# Zeabur éƒ¨ç½²æŒ‡å—

> **æ–‡æª”ç‰ˆæœ¬**: 1.0.0
> **æœ€å¾Œæ›´æ–°**: 2025-11-11
> **é©ç”¨å°ˆæ¡ˆç‰ˆæœ¬**: v2.3.1+

## ğŸ“‹ ç›®éŒ„

- [æ¶æ§‹èªªæ˜](#æ¶æ§‹èªªæ˜)
- [ç’°å¢ƒé…ç½®](#ç’°å¢ƒé…ç½®)
- [éƒ¨ç½²æµç¨‹](#éƒ¨ç½²æµç¨‹)
- [æ³¨æ„äº‹é …](#æ³¨æ„äº‹é …)
- [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
- [ç›£æ§èˆ‡ç¶­è­·](#ç›£æ§èˆ‡ç¶­è­·)

---

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

### éƒ¨ç½²æ¨¡å¼

KCISLK èª²è¡¨æŸ¥è©¢ç³»çµ±åœ¨ Zeabur ä¸Šæ¡ç”¨ **å®Œå…¨è§£è€¦æ¶æ§‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Zeabur Cloud Platform                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Frontend Service     â”‚    â”‚ Backend Service      â”‚ â”‚
â”‚  â”‚ (Vite Static Host)   â”‚    â”‚ (Docker Container)   â”‚ â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚ â”‚
â”‚  â”‚ â”œ index.html         â”‚    â”‚ â”œ Flask API (8080)  â”‚ â”‚
â”‚  â”‚ â”œ assets/*.js        â”‚    â”‚ â”œ SQLAlchemy        â”‚ â”‚
â”‚  â”‚ â”” assets/*.css       â”‚    â”‚ â”” SQLite            â”‚ â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚ â”‚
â”‚  â”‚ ç„¡ Nginx             â”‚    â”‚ CORS: Enabled       â”‚ â”‚
â”‚  â”‚ ç„¡ä¼ºæœå™¨é‚è¼¯         â”‚    â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                            â–²               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
            â”‚   [ä½¿ç”¨è€…ç€è¦½å™¨]           â”‚
            â”‚         â”‚                  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                  è¼‰å…¥ HTML/JS
                      â”‚
              Axios å‘¼å« API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              https://kcislk-backend.zeabur.app/api
```

### é—œéµç‰¹æ€§

1. **Frontend**ï¼šVite éœæ…‹æ‰˜ç®¡
   - é…ç½®æª”æ¡ˆï¼š`zeabur.json`
   - éƒ¨ç½²æ–¹å¼ï¼šè‡ªå‹•åµæ¸¬ Vite æ¡†æ¶
   - è¨—ç®¡å…§å®¹ï¼šåªæœ‰ HTML/JS/CSS éœæ…‹æª”æ¡ˆ
   - **ä¸ä½¿ç”¨** `Dockerfile.frontend.docker`ï¼ˆè©²æª”æ¡ˆåƒ…ç”¨æ–¼æœ¬åœ° Docker Composeï¼‰

2. **Backend**ï¼šDocker å®¹å™¨éƒ¨ç½²
   - é…ç½®æª”æ¡ˆï¼š`Dockerfile.backend.docker`
   - éƒ¨ç½²æ–¹å¼ï¼šè‡ªå‹•åµæ¸¬ Dockerfile
   - ç›£è½ç«¯å£ï¼šç”± Zeabur å‹•æ…‹åˆ†é…ï¼ˆç’°å¢ƒè®Šæ•¸ `PORT`ï¼‰
   - é è¨­å€¼ï¼š5000ï¼ˆå¦‚æœªè¨­å®š `PORT`ï¼‰

3. **é€šè¨Šæ–¹å¼**ï¼šç›´æ¥ CORS å‘¼å«
   - Frontend é€é `axios` ç›´æ¥å‘¼å« Backend API
   - Backend çš„ `allowed_origins` åŒ…å«æ‰€æœ‰ Frontend åŸŸå
   - **ä¸éœ€è¦** Nginx åå‘ä»£ç†

---

## âš™ï¸ ç’°å¢ƒé…ç½®

### Frontend ç’°å¢ƒè®Šæ•¸

#### å¿…è¦è®Šæ•¸

| è®Šæ•¸åç¨± | å€¼ | èªªæ˜ |
|---------|---|------|
| `NODE_VERSION` | `20` | Node.js ç‰ˆæœ¬ |
| `VITE_API_BASE_URL` | `https://kcislk-backend.zeabur.app/api` | Backend API å®Œæ•´ URL |
| `VITE_ENABLE_EXAM_PROCTOR` | `true` / `false` | æœŸä¸­è€ƒç›£è€ƒåŠŸèƒ½é–‹é—œ |

#### å»ºè­°è®Šæ•¸ï¼ˆå¯é¸ï¼‰

| è®Šæ•¸åç¨± | å€¼ | èªªæ˜ |
|---------|---|------|
| `VITE_APP_TITLE` | `KCISLK èª²è¡¨æŸ¥è©¢ç³»çµ± (Develop)` | æ‡‰ç”¨æ¨™é¡Œ |
| `VITE_DEPLOY_ENV` | `zeabur` | éƒ¨ç½²ç’°å¢ƒè­˜åˆ¥ |
| `NODE_ENV` | `staging` / `production` | Node.js ç’°å¢ƒ |

#### éŒ¯èª¤è®Šæ•¸ï¼ˆè«‹å‹¿è¨­å®šï¼‰

ä»¥ä¸‹è®Šæ•¸åœ¨ Vite éœæ…‹æ‰˜ç®¡æ¨¡å¼ä¸‹ **ä¸éœ€è¦è¨­å®š**ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†ï¼š

- `BACKEND_HOST` âŒï¼ˆZeabur å…§éƒ¨æœå‹™ IDï¼Œä»£ç¢¼æœªä½¿ç”¨ï¼‰
- `FRONTEND_HOST` âŒï¼ˆZeabur å…§éƒ¨æœå‹™ IDï¼Œä»£ç¢¼æœªä½¿ç”¨ï¼‰
- `PASSWORD` âŒï¼ˆä¸æ‡‰å‡ºç¾åœ¨å‰ç«¯ç’°å¢ƒè®Šæ•¸ï¼‰

### Backend ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸åç¨± | å€¼ | èªªæ˜ |
|---------|---|------|
| `PORT` | ç”± Zeabur è‡ªå‹•è¨­å®š | æœå‹™ç›£è½ç«¯å£ |
| `FLASK_ENV` | `production` | Flask ç’°å¢ƒ |
| `DATABASE_PATH` | `/app/database/app.db` | SQLite è³‡æ–™åº«è·¯å¾‘ |
| `ALLOWED_ORIGINS` | å¯é¸ | é¡å¤–çš„ CORS å…è¨±åŸŸåï¼ˆé€—è™Ÿåˆ†éš”ï¼‰ |

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### åˆæ¬¡éƒ¨ç½²

#### 1. æº–å‚™ Git Repository

ç¢ºä¿å°ˆæ¡ˆå·²æ¨é€åˆ° GitHubï¼š

```bash
git add .
git commit -m "æº–å‚™ Zeabur éƒ¨ç½²"
git push origin main
```

#### 2. åœ¨ Zeabur å»ºç«‹å°ˆæ¡ˆ

1. ç™»å…¥ [Zeabur æ§åˆ¶å°](https://dash.zeabur.com)
2. é»æ“Šã€ŒNew Projectã€
3. é€£æ¥ GitHub Repository
4. é¸æ“‡ `kcislk-timetable` å°ˆæ¡ˆ

#### 3. éƒ¨ç½² Backend Service

1. é»æ“Šã€ŒAdd Serviceã€â†’ã€ŒDeploy from GitHubã€
2. é¸æ“‡ `main` åˆ†æ”¯
3. Zeabur è‡ªå‹•åµæ¸¬ `Dockerfile.backend.docker`
4. è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆè¦‹ä¸Šæ–¹ Backend ç’°å¢ƒè®Šæ•¸è¡¨ï¼‰
5. éƒ¨ç½²å®Œæˆå¾Œï¼Œè¨˜éŒ„ Backend URLï¼ˆä¾‹å¦‚ï¼š`kcislk-backend.zeabur.app`ï¼‰

#### 4. éƒ¨ç½² Frontend Service

1. é»æ“Šã€ŒAdd Serviceã€â†’ã€ŒDeploy from GitHubã€
2. é¸æ“‡ `develop` æˆ– `main` åˆ†æ”¯
3. Zeabur è‡ªå‹•åµæ¸¬ `zeabur.json` â†’ ä½¿ç”¨ Vite éœæ…‹æ‰˜ç®¡
4. è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆè¦‹ä¸Šæ–¹ Frontend ç’°å¢ƒè®Šæ•¸è¡¨ï¼‰
5. **ç‰¹åˆ¥æ³¨æ„**ï¼š`VITE_API_BASE_URL` å¿…é ˆæŒ‡å‘æ­¥é©Ÿ 3 çš„ Backend URL

#### 5. é©—è­‰éƒ¨ç½²

```bash
# æ¸¬è©¦ Backend API
curl https://kcislk-backend.zeabur.app/api/health

# æ¸¬è©¦ Frontendï¼ˆç€è¦½å™¨é–‹å•Ÿï¼‰
open https://<frontend-url>.zeabur.app
```

### æ›´æ–°éƒ¨ç½²

#### è‡ªå‹•éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

Zeabur æœƒè‡ªå‹•ç›£è½ GitHub æ¨é€ï¼Œç•¶æœ‰æ–°çš„ commit æ™‚è‡ªå‹•é‡æ–°éƒ¨ç½²ï¼š

```bash
git add .
git commit -m "æ›´æ–°åŠŸèƒ½"
git push origin main  # æˆ– develop
```

#### æ‰‹å‹•éƒ¨ç½²

1. é€²å…¥ Zeabur æ§åˆ¶å°
2. æ‰¾åˆ°å°æ‡‰çš„ Service
3. é»æ“Šã€ŒRedeployã€æŒ‰éˆ•

---

## âš ï¸ æ³¨æ„äº‹é …

### 1. Dockerfile å‘½åè¦å‰‡

ç‚ºé¿å… Zeabur èª¤åˆ¤éƒ¨ç½²æ¨¡å¼ï¼Œå°ˆæ¡ˆä½¿ç”¨ä»¥ä¸‹å‘½åè¦å‰‡ï¼š

| æª”æ¡ˆåç¨± | ç”¨é€” |
|---------|------|
| `Dockerfile.frontend.docker` | æœ¬åœ° Docker Compose ä½¿ç”¨ï¼ŒZeabur **ä¸ä½¿ç”¨** |
| `Dockerfile.backend.docker` | Zeabur Backend éƒ¨ç½²ä½¿ç”¨ |
| `zeabur.json` | Frontend éƒ¨ç½²é…ç½®ï¼ˆVite éœæ…‹æ‰˜ç®¡ï¼‰ |

**é‡è¦**ï¼šå°ˆæ¡ˆæ ¹ç›®éŒ„ä¸æ‡‰å­˜åœ¨ `Dockerfile.frontend` æª”æ¡ˆï¼Œå¦å‰‡ Zeabur å¯èƒ½å„ªå…ˆä½¿ç”¨ Docker æ¨¡å¼è€Œé Vite éœæ…‹æ‰˜ç®¡ã€‚

### 2. API URL é…ç½®

ä¸åŒç’°å¢ƒçš„ `VITE_API_BASE_URL` é…ç½®ï¼š

| ç’°å¢ƒ | API URL | èªªæ˜ |
|-----|---------|------|
| æœ¬åœ°é–‹ç™¼ | `http://localhost:8081/api` | ç›´æ¥å‘¼å«æœ¬åœ° Flask |
| Zeabur Staging | `https://kcislk-backend.zeabur.app/api` | ç›´æ¥ CORS å‘¼å« |
| Zeabur Production | `https://kcislk-backend.zeabur.app/api` | ç›´æ¥ CORS å‘¼å« |

**éŒ¯èª¤é…ç½®ç¯„ä¾‹**ï¼ˆè«‹å‹¿ä½¿ç”¨ï¼‰ï¼š
- âŒ `https://staging.kcislk-timetable.edu.tw/api`ï¼ˆå‡è¨­ Nginx ä»£ç†ï¼Œä½† Zeabur Vite æ¨¡å¼ç„¡ Nginxï¼‰
- âŒ `/api`ï¼ˆç›¸å°è·¯å¾‘ï¼Œåªé©ç”¨æ–¼ Nginx åŒåŸŸä»£ç†ï¼‰

### 3. CORS é…ç½®ç¶­è­·

ç•¶æ–°å¢ Frontend åŸŸåæ™‚ï¼Œå‹™å¿…æ›´æ–° Backend çš„ `allowed_origins`ï¼š

**æª”æ¡ˆä½ç½®**ï¼š`timetable_api/src/main.py`ï¼ˆline 17-27ï¼‰

```python
allowed_origins = [
    'http://localhost:3000',
    'https://kcislk-timetable.zeabur.app',
    'https://frontend-develop.zeabur.app',
    # æ–°å¢åŸŸåè«‹åŠ åœ¨æ­¤è™•
    'https://<new-frontend-domain>.zeabur.app',
]
```

### 4. ç’°å¢ƒè®Šæ•¸æ›´æ–°

ä¿®æ”¹ç’°å¢ƒè®Šæ•¸å¾Œï¼Œéœ€è¦æ‰‹å‹•è§¸ç™¼ Redeployï¼š

1. Zeabur æ§åˆ¶å° â†’ Service â†’ Environment Variables
2. ä¿®æ”¹è®Šæ•¸
3. é»æ“Šã€ŒSaveã€
4. é»æ“Šã€ŒRedeployã€

**æ³¨æ„**ï¼šåƒ…ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ä¸æœƒè‡ªå‹•é‡æ–°éƒ¨ç½²æœå‹™ã€‚

---

## ğŸ”§ å¸¸è¦‹å•é¡Œ

### Q1: éƒ¨ç½²å¾Œå‡ºç¾ 502 Bad Gateway

**å¯èƒ½åŸå› **ï¼š
1. Frontend èª¤ç”¨ Docker æ¨¡å¼ï¼ˆæ‡‰ä½¿ç”¨ Vite éœæ…‹æ‰˜ç®¡ï¼‰
2. Nginx é…ç½®è©¦åœ–ä»£ç†åˆ°ä¸å­˜åœ¨çš„ `backend:8080`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèªå°ˆæ¡ˆæ ¹ç›®éŒ„ä¸å­˜åœ¨ `Dockerfile.frontend` æª”æ¡ˆ
2. ç¢ºèª `zeabur.json` é…ç½®å­˜åœ¨ä¸”æ­£ç¢º
3. åˆªé™¤ Frontend Service é‡æ–°å»ºç«‹ï¼Œç¢ºä¿ä½¿ç”¨ Vite æ¨¡å¼

### Q2: CORS éŒ¯èª¤ (Access-Control-Allow-Origin)

**å¯èƒ½åŸå› **ï¼š
1. Backend çš„ `allowed_origins` æœªåŒ…å« Frontend åŸŸå
2. ç’°å¢ƒè®Šæ•¸ `VITE_API_BASE_URL` é…ç½®éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ `timetable_api/src/main.py` çš„ `allowed_origins` æ¸…å–®
2. æ–°å¢ Frontend åŸŸååˆ°æ¸…å–®
3. æäº¤è®Šæ›´ä¸¦æ¨é€è§¸ç™¼é‡æ–°éƒ¨ç½²

### Q3: ç’°å¢ƒè®Šæ•¸æœªç”Ÿæ•ˆ

**å¯èƒ½åŸå› **ï¼š
1. ä¿®æ”¹å¾Œæœªè§¸ç™¼ Redeploy
2. ç’°å¢ƒè®Šæ•¸åç¨±éŒ¯èª¤ï¼ˆVite è®Šæ•¸å¿…é ˆä»¥ `VITE_` é–‹é ­ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ä¿®æ”¹ç’°å¢ƒè®Šæ•¸å¾Œæ‰‹å‹•é»æ“Šã€ŒRedeployã€
2. ç¢ºèªè®Šæ•¸åç¨±æ‹¼å¯«æ­£ç¢º
3. ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·æª¢æŸ¥ `import.meta.env`

### Q4: Build å¤±æ•— (npm install error)

**å¯èƒ½åŸå› **ï¼š
1. Node.js ç‰ˆæœ¬ä¸ç¬¦
2. `package-lock.json` ç‰ˆæœ¬è¡çª

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç¢ºèª `NODE_VERSION=20` ç’°å¢ƒè®Šæ•¸
2. ä½¿ç”¨ `npm ci --legacy-peer-deps` å®‰è£æŒ‡ä»¤ï¼ˆå·²åœ¨ `zeabur.json` é…ç½®ï¼‰

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### æ—¥èªŒæŸ¥çœ‹

#### Frontend æ—¥èªŒ
1. Zeabur æ§åˆ¶å° â†’ Frontend Service â†’ Logs
2. æŸ¥çœ‹å»ºç½®æ—¥èªŒå’Œéƒ¨ç½²æ—¥èªŒ

#### Backend æ—¥èªŒ
1. Zeabur æ§åˆ¶å° â†’ Backend Service â†’ Logs
2. æŸ¥çœ‹ Flask é‹è¡Œæ—¥èªŒå’Œ API è«‹æ±‚æ—¥èªŒ

### æ•ˆèƒ½ç›£æ§

å»ºè­°ç›£æ§æŒ‡æ¨™ï¼š

| æŒ‡æ¨™ | æ­£å¸¸å€¼ | èªªæ˜ |
|-----|-------|------|
| Frontend Build Time | < 2 åˆ†é˜ | Vite å»ºç½®æ™‚é–“ |
| Backend Startup Time | < 30 ç§’ | Flask å•Ÿå‹•æ™‚é–“ |
| API Response Time | < 500ms | API å¹³å‡å›æ‡‰æ™‚é–“ |
| CORS Success Rate | 100% | CORS å‘¼å«æˆåŠŸç‡ |

### å‚™ä»½ç­–ç•¥

1. **Git ç‰ˆæœ¬æ§åˆ¶**ï¼šæ‰€æœ‰ä»£ç¢¼è®Šæ›´æäº¤åˆ° GitHub
2. **è³‡æ–™åº«å‚™ä»½**ï¼šå®šæœŸå‚™ä»½ SQLite è³‡æ–™åº«ï¼ˆä½¿ç”¨ Docker Compose çš„ `db-backup` æœå‹™ï¼‰
3. **ç’°å¢ƒè®Šæ•¸å‚™ä»½**ï¼šè¨˜éŒ„æ‰€æœ‰ç’°å¢ƒè®Šæ•¸è¨­å®šåˆ°å®‰å…¨ä½ç½®

---

## ğŸ“š åƒè€ƒè³‡æº

- [Zeabur å®˜æ–¹æ–‡æª”](https://docs.zeabur.com)
- [Vite éƒ¨ç½²æŒ‡å—](https://vitejs.dev/guide/static-deploy.html)
- [Flask CORS é…ç½®](https://flask-cors.readthedocs.io/)
- [å°ˆæ¡ˆ README](../../README.md)
- [API æ–‡æª”](../api/README.md)

---

**æ–‡æª”ç¶­è­·è€…**: Claude Code
**è¯çµ¡æ–¹å¼**: é€é GitHub Issues å›å ±å•é¡Œ
**æœ€å¾Œå¯©æŸ¥**: 2025-11-11
